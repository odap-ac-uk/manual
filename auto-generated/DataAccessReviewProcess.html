<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.296">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Access Review Process</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="DataAccessReviewProcess_files/libs/clipboard/clipboard.min.js"></script>
<script src="DataAccessReviewProcess_files/libs/quarto-html/quarto.js"></script>
<script src="DataAccessReviewProcess_files/libs/quarto-html/popper.min.js"></script>
<script src="DataAccessReviewProcess_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="DataAccessReviewProcess_files/libs/quarto-html/anchor.min.js"></script>
<link href="DataAccessReviewProcess_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="DataAccessReviewProcess_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="DataAccessReviewProcess_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="DataAccessReviewProcess_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="DataAccessReviewProcess_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="https://odap.ac.uk/style.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#scope-of-data-access-process" id="toc-scope-of-data-access-process" class="nav-link active" data-scroll-target="#scope-of-data-access-process"><span class="header-section-number">1</span> Scope of Data Access Process</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">2</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#definitions" id="toc-definitions" class="nav-link" data-scroll-target="#definitions"><span class="header-section-number">2.1</span> Definitions</a></li>
  <li><a href="#key-principles" id="toc-key-principles" class="nav-link" data-scroll-target="#key-principles"><span class="header-section-number">2.2</span> Key Principles</a></li>
  <li><a href="#transparency-reporting" id="toc-transparency-reporting" class="nav-link" data-scroll-target="#transparency-reporting"><span class="header-section-number">2.3</span> Transparency reporting</a></li>
  </ul></li>
  <li><a href="#odap-review-processes" id="toc-odap-review-processes" class="nav-link" data-scroll-target="#odap-review-processes"><span class="header-section-number">3</span> ODAP Review processes</a>
  <ul class="collapse">
  <li><a href="#simplified-review-process" id="toc-simplified-review-process" class="nav-link" data-scroll-target="#simplified-review-process"><span class="header-section-number">3.1</span> Simplified review process</a></li>
  <li><a href="#dataset-availability" id="toc-dataset-availability" class="nav-link" data-scroll-target="#dataset-availability"><span class="header-section-number">3.2</span> Dataset availability</a></li>
  <li><a href="#accreditation-of-researchers" id="toc-accreditation-of-researchers" class="nav-link" data-scroll-target="#accreditation-of-researchers"><span class="header-section-number">3.3</span> Accreditation of Researchers</a>
  <ul class="collapse">
  <li><a href="#review-of-researcher-credentials-by-odap-data-access-team" id="toc-review-of-researcher-credentials-by-odap-data-access-team" class="nav-link" data-scroll-target="#review-of-researcher-credentials-by-odap-data-access-team"><span class="header-section-number">3.3.1</span> Review of researcher credentials by ODAP data access team</a></li>
  <li><a href="#decision-and-notification" id="toc-decision-and-notification" class="nav-link" data-scroll-target="#decision-and-notification"><span class="header-section-number">3.3.2</span> Decision and notification</a></li>
  </ul></li>
  <li><a href="#bona-fide-researchers" id="toc-bona-fide-researchers" class="nav-link" data-scroll-target="#bona-fide-researchers"><span class="header-section-number">3.4</span> Bona Fide researchers</a></li>
  </ul></li>
  <li><a href="#review-of-research-proposals" id="toc-review-of-research-proposals" class="nav-link" data-scroll-target="#review-of-research-proposals"><span class="header-section-number">4</span> Review of Research Proposals</a>
  <ul class="collapse">
  <li><a href="#safe-projects" id="toc-safe-projects" class="nav-link" data-scroll-target="#safe-projects"><span class="header-section-number">4.1</span> Safe projects</a>
  <ul class="collapse">
  <li><a href="#scope" id="toc-scope" class="nav-link" data-scroll-target="#scope"><span class="header-section-number">4.1.1</span> Scope</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">4.1.2</span> Examples</a></li>
  </ul></li>
  <li><a href="#process" id="toc-process" class="nav-link" data-scroll-target="#process"><span class="header-section-number">4.2</span> Process</a>
  <ul class="collapse">
  <li><a href="#amendment-process" id="toc-amendment-process" class="nav-link" data-scroll-target="#amendment-process"><span class="header-section-number">4.2.1</span> Amendment process</a></li>
  <li><a href="#appeals-process" id="toc-appeals-process" class="nav-link" data-scroll-target="#appeals-process"><span class="header-section-number">4.2.2</span> Appeals process</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="DataAccessReviewProcess.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Access Review Process</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="scope-of-data-access-process" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Scope of Data Access Process</h1>
<p>In order to facilitate rapid data sharing during the immediate response to new threats, data from a range of contributors is linked within the ODAP. This data cannot be shared by the process described here unless two conditions are met:</p>
<ol type="1">
<li>A legal agreement is in place allowing the ODAP to take on the role of data controller for the data, and</li>
<li>The data contributor has explicitly lifted the embargo on the data.</li>
</ol>
</section>
<section id="introduction" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Introduction</h1>
<p>The Outbreak Data Analysis Platform (ODAP) has committed to meet the ‘<a href="https://blog.ons.gov.uk/2017/01/27/the-five-safes-data-privacy-at-ons/">Five Safes</a>’ framework to foster responsible and trustworthy uses of data:</p>
<ol type="1">
<li><p><strong><em>Safe projects:</em></strong> Is the use of data appropriate?</p></li>
<li><p><strong><em>Safe data:</em></strong> is the risk of disclosure in the data minimised?</p></li>
<li><p><strong><em>Safe people:</em></strong> can users be trusted to use the data in an appropriate manner?</p></li>
<li><p><strong><em>Safe settings:</em></strong> can data be accessed in a Trusted Research Environment?</p></li>
<li><p><strong><em>Safe outputs:</em></strong> are there disclosure risks from reported results?</p></li>
</ol>
<p>This policy focuses on ‘Safe people’, ‘safe projects’ and introduces ‘safe outputs’.</p>
<section id="definitions" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="definitions"><span class="header-section-number">2.1</span> Definitions</h2>
<p><strong>Safe People</strong> should have the right motivations for accessing research data and understand the legal and ethical considerations when using data that may be sensitive or confidential. Safe People should also have sufficient skills, knowledge, and experience to work with the data effectively. Researchers may need to undergo specific training or accreditation before accessing certain data or research environments and demonstrate that they are part of a bona fide research organisation.</p>
<p><strong>Safe projects</strong> are those that have a valid research purpose with a defined public benefit. For access to data to be granted the researchers need to demonstrate that their proposal is an appropriate and ethical use of the data, and that it is intended to deliver clear public benefits.</p>
<p><strong>Safe outputs</strong> ensure that all research outputs cannot be used to identify data subjects. They typically include ‘descriptive statistics’ that have been sufficiently aggregated such that identification is near enough impossible, and modelled outputs which are inherently non-confidential.</p>
</section>
<section id="key-principles" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="key-principles"><span class="header-section-number">2.2</span> Key Principles</h2>
<p>The review process must:</p>
<ul>
<li><p>Be proportionate</p></li>
<li><p>Meet the requirements of the 'five safes' framework and help build a trustworthy approach</p></li>
<li><p>Be light-touch and streamlined to allow access to be approved rapidly</p></li>
<li><p>Be scalable</p></li>
<li><p>Where multiple datasets are involved, every effort must be made to avoid duplicating review processes</p></li>
<li><p>For security and to handle changes of circumstance, access is time bound and should be subject to review at regular intervals</p></li>
</ul>
</section>
<section id="transparency-reporting" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="transparency-reporting"><span class="header-section-number">2.3</span> Transparency reporting</h2>
<p>ODAP is committed to transparency across all its activities, and so will provide information about all research projects that have been approved to take place in the Platform. For projects that have been approved, we will publish the researcher’s name, organisational affiliation, project title and lay project summary on the ODAP website: <a href="https://odap.ac.uk/">odap.ac.uk</a>. For projects that are not approved, we will record the reasons for rejection, using agreed categories.</p>
</section>
</section>
<section id="odap-review-processes" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> ODAP Review processes</h1>
<p>To apply for access, researchers will complete the <a href="https://odap.ac.uk/forms/HDRUK_5_Safes_Application_Form.pdf">HDR UK “five safes” data access application form</a>.</p>
<section id="simplified-review-process" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="simplified-review-process"><span class="header-section-number">3.1</span> Simplified review process</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><embed src="images/data_access/simple_access.pdf" class="quarto-discovered-preview-image img-fluid"></p>
<p></p><figcaption class="figure-caption">Flow diagram for review process</figcaption><p></p>
</figure>
</div>
<p>In order to meet the ‘safe people’ and ‘safe projects’ requirements, approval will take the following steps:</p>
<ol type="1">
<li>Researcher applies for access data</li>
<li>Accreditation of researcher</li>
<li>Review of research proposal</li>
<li>Researcher approved to access data</li>
</ol>
<p>The on-boarding and availability of datasets within ODAP is a separate process. All data access projects must have the potential to have direct impact to address the approved research scope and provide patient benefit.</p>
</section>
<section id="dataset-availability" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="dataset-availability"><span class="header-section-number">3.2</span> Dataset availability</h2>
<p>Once data is available for access, a researcher can search for data through the HDR UK Innovation Gateway/ODAP website and wiki. The Gateway includes a number of functions:</p>
<ul>
<li>search engine to allow researchers to discover data</li>
<li>Data Access Request form for researchers to apply for data</li>
</ul>
<p>The next two sections set out the process for researcher accreditation and review of project proposal. The two processes can happen in parallel rather than sequentially. However, we have illustrated them as separate reviews because, in future, an accredited researcher might apply to access data for a second research project. In such a case, the researcher accreditation would not need to be repeated, only the project proposal would be reviewed.</p>
</section>
<section id="accreditation-of-researchers" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="accreditation-of-researchers"><span class="header-section-number">3.3</span> Accreditation of Researchers</h2>
<p>In order to ensure access is restricted to ‘safe people’, ODAP has introduced a process to accredit researchers. This will help ensure users can be trusted to use data in an appropriate manner, giving confidence to data contributors that data will be used responsibly, and enabling high quality research to be conducted using data in the Platform.</p>
<section id="review-of-researcher-credentials-by-odap-data-access-team" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="review-of-researcher-credentials-by-odap-data-access-team"><span class="header-section-number">3.3.1</span> Review of researcher credentials by ODAP data access team</h3>
<p>The ODAP data access team will undertake a light-touch check of researcher credentials, using the following criteria:</p>
<ul>
<li><p>All the requested information has been provided</p></li>
<li><p>The researcher is affiliated to a legitimate organisation conducting research (verified via institutional email address, institutional webpage profile or publication record)</p></li>
<li><p>The researcher is a bona fide researcher (see below)</p></li>
<li><p>The researcher has the professional qualifications and experience to work with health data ().</p></li>
<li><p>The researcher has a certificate demonstraing completion of the ONS training course in clinical data handling.</p></li>
</ul>
<p>If any of the requested fields have not been completed, or if further details are required, the data access team will contact the applicant for additional information. Once full details have been provided, the data access team will make an accreditation decision to the best of their judgement, but may also seek a second opinion from within the wider ODAP data team in the Lead Institute for complex cases.</p>
</section>
<section id="decision-and-notification" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="decision-and-notification"><span class="header-section-number">3.3.2</span> Decision and notification</h3>
<p>There are two possible outcomes:</p>
<ul>
<li><p>the researcher is accredited</p></li>
<li><p>the researcher’s application is rejected.</p></li>
</ul>
<p>The researcher is notified of the decision by email, including the reason for rejection (where relevant). The accreditation decision is recorded in the ODAP internal records log (kept confidentially), a password-protected database.</p>
</section>
</section>
<section id="bona-fide-researchers" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="bona-fide-researchers"><span class="header-section-number">3.4</span> Bona Fide researchers</h2>
<p>The term bona fide researcher is often used but rarely defined. We use the definition adopted by the UK Medical Research Council in its Policy and Guidance on Sharing of Research Data from Population and Patient Studies.</p>
<p>A bona fide researcher is a person with:</p>
<ul>
<li>the professional expertise and experience to conduct bona fide research and</li>
<li>a formal relationship with a bona fide research organisation that requires compliance with appropriate research governance and management systems. Bona fide research can be considered to be as follows:</li>
<li>An intention to generate new knowledge and understanding using rigorous scientific methods. (This includes discovery research, development and validation of methodology and technology, validating and challenging previous findings, and pilot research). And…</li>
<li>An intention to publish the research findings and share the derived data in the scientific community, without restrictions and with minimal delay, for wider scientific and eventual public benefit. (Recognised constraints include a short prepublication delay to ensure proper management of intellectual property). And…</li>
<li>The intended activities are not inconsistent with legal and ethical requirements or widely recognised good research practice.</li>
</ul>
<p>A bona fide research organisation is one that has the capability to lead or participate in high quality, ethical research. It will have a public commitment to adhere to recognised research and information governance good practice. (It is not a requirement that such research is the primary business of that organisation, or that all of the research undertaken by that organisation is published. Nor is it a requirement that the organisation be publicly funded.)</p>
</section>
</section>
<section id="review-of-research-proposals" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Review of Research Proposals</h1>
<section id="safe-projects" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="safe-projects"><span class="header-section-number">4.1</span> Safe projects</h2>
<p>Proposals need to be reviewed to ensure the use of the data is appropriate, within the scope of the ODAP, and that the project has a valid research purpose with a defined public benefit.</p>
<section id="scope" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="scope"><span class="header-section-number">4.1.1</span> Scope</h3>
<p><strong>The purpose of the ODAP is to facilitate biomedical research to advance understanding of severe infectious disease* and other exposures of public health interest.** Research within the ODAP is strictly limited to this purpose.</strong></p>
<p>* Severe infectious disease - this term describes all severe infectious agents, including new, re-emerging or therapy-resistant forms of existing infectious agents.</p>
<p>** Other exposures of public health interest: this term describes new or unexplained poisoning, or exposure to harmful energy sources such as electromagnetic radiation.</p>
<p>The scope of ODAP is designed to carefully match the scope of the ISARIC-CCP.</p>
</section>
<section id="examples" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="examples"><span class="header-section-number">4.1.2</span> Examples</h3>
<p>Examples of in-scope research: - Understanding the evolution and biology of SARS-CoV-2. - Understanding the epidemiology and transmission of SARS-CoV-2. - Understanding COVID-19 disease risk, severity and outcomes. - Monitoring and understanding the impact of non-pharmacological interventions against SARS-CoV-2 transmissions and COVID-19 disease. - Monitoring, understanding, and assessing the impact of treatments, vaccines and prior infections in COVID-19 disease. - Analysing or modelling SARS-CoV-2 and COVID-19 data for future pandemic preparedness.</p>
<p>Examples of out of scope activities - Their research questions primarily focusses on a non-infectious disease area with incidental involvement of infectious disease (Focussed on a pathogen with no potential public health concern)</p>
</section>
</section>
<section id="process" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="process"><span class="header-section-number">4.2</span> Process</h2>
<p>The process of reviewing research proposals is as follows:</p>
<ol type="1">
<li><p>Application. The researcher provides basic information about the proposed project as detailed in the <a href="https://odap.ac.uk/forms/HDRUK_5_Safes_Application_Form.pdf">HDR UK “five safes” data access application form</a>.</p></li>
<li><p>Internal review. The proposals will initially be triaged by the ODAP data access team, and then referred to the Project Review Panel. Where necessary, the researcher may need to be contacted to provide further information or clarification. The review will be light-touch, and based on the following criteria:</p>
<ul>
<li><p>Does the research question fit within the scope of the ODAP?</p></li>
<li><p>Is the relevant data available?</p></li>
</ul></li>
<li><p>Decision. There are three possible outcomes:</p>
<ul>
<li><p>The proposal is approved</p></li>
<li><p>the proposal is rejected</p></li>
<li><p>The proposal is returned to the applicant with suggestions for changes that need to be made before it can be approved.</p></li>
</ul>
<p>The researcher is notified of the decision, including the reason for rejection (where relevant). The decision is recorded, and metrics kept on approvals and rejections. The decision is recorded in the ODAP internal records log (kept confidentially), a password-protected database.</p>
<p>Reasons for rejection, which will be recorded, might include:</p>
<ul>
<li><p>Data not available to access via the ODAP</p></li>
<li><p>Research proposal does not meet the informed consent requirements for that dataset</p></li>
<li><p>Research proposal requires identifiable patient data or there is a risk to participant privacy</p></li>
<li><p>The proposal is not in the public interest</p></li>
</ul></li>
</ol>
<section id="amendment-process" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="amendment-process"><span class="header-section-number">4.2.1</span> Amendment process</h3>
<p>Any amendments to approved applications will be reviewed by the Project Review Panel.</p>
</section>
<section id="appeals-process" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="appeals-process"><span class="header-section-number">4.2.2</span> Appeals process</h3>
<p>Any appeals may be escalated to the <a href="https://odap.ac.uk/manual/auto-generated/DAGC_ToR.pdf">Data Access Governance Committee (DAGC)</a>.</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>